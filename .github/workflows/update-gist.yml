name: Mirror sample-code to Gist

on:
  push:
    paths:
      - 'sample-code/**'
    branches:
      - main
  delete:
    paths:
      - 'sample-code/**'

jobs:
  sync-to-gist:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install requests

      - name: Mirror sample-code to Gist
        env:
          GIST_ID: ff4744ea8665a67d797e36f85e5de726
          GITHUB_TOKEN: ${{ secrets.GIST_TOKEN }}
        run: |
          python3 <<'PYCODE'
          import os, requests, json

          gist_id = os.environ["GIST_ID"]
          token = os.environ["GITHUB_TOKEN"]
          headers = {
              "Authorization": f"token {token}",
              "Accept": "application/vnd.github.v3+json"
          }

          # --- 1. Fetch current Gist state ---
          gist_url = f"https://api.github.com/gists/{gist_id}"
          resp = requests.get(gist_url, headers=headers)
          if resp.status_code != 200:
              print("âŒ Failed to fetch Gist:", resp.status_code, resp.text)
              exit(1)
